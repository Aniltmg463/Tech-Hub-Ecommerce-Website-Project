# System Design - High-Level Architecture

## Overview
This document contains the System Design diagrams for the TechHub E-Commerce platform. It shows the high-level architecture, system boundaries, external interfaces, and technology stack.

## System Design Diagrams

### 1. System Context Diagram

```plantuml
@startuml System_Context_Diagram

title TechHub E-Commerce - System Context Diagram

!define RECTANGLE rectangle

skinparam rectangle {
    BackgroundColor<< system >> LightBlue
    BackgroundColor<< external >> LightYellow
    BorderColor Black
}

actor "Customer" as customer
actor "Admin" as admin

RECTANGLE "TechHub E-Commerce\nSystem" << system >> as system {
}

RECTANGLE "Braintree\nPayment Gateway" << external >> as braintree
RECTANGLE "Email Service\n(SMTP)" << external >> as email
RECTANGLE "MongoDB Atlas\nDatabase" << external >> as mongodb
RECTANGLE "Web Browser" << external >> as browser

customer --> system : Browse products\nPlace orders\nTrack shipments
admin --> system : Manage products\nManage categories\nManage orders\nManage users

system --> braintree : Process payments\nGenerate tokens
braintree --> system : Payment confirmation\nTransaction ID

system --> email : Send order confirmations\nSend shipping updates\nSend notifications
email --> customer : Email notifications
email --> admin : Admin alerts

system --> mongodb : Store/retrieve data
mongodb --> system : Data persistence

customer --> browser : Access application
browser --> system : HTTP/HTTPS requests
system --> browser : Web pages\nJSON responses

note right of system
  **Core System Responsibilities:**
  • Product catalog management
  • User authentication & authorization
  • Shopping cart & checkout
  • Order processing & tracking
  • Payment integration
  • Inventory management
  • Product recommendations (Jaccard)
  • Admin dashboard
end note

note bottom of braintree
  **External Payment Service**
  • PCI DSS compliant
  • Handles credit card processing
  • No sensitive data stored internally
  • Token-based transactions
end note

@enduml
```

### 2. High-Level System Architecture

```plantuml
@startuml High_Level_Architecture

title TechHub E-Commerce - High-Level System Architecture

package "Presentation Layer" {
    [React Frontend] as frontend
    [React Router] as router
    [UI Components] as components
    [Context Providers] as context
}

package "API Layer" {
    [Express Server] as express
    [REST API] as api
    [Middleware Stack] as middleware
}

package "Business Logic Layer" {
    [Controllers] as controllers
    [Services] as services
    [Helpers] as helpers
}

package "Data Access Layer" {
    [Mongoose ODM] as mongoose
    [Model Schemas] as models
}

package "External Services" {
    [Braintree SDK] as braintree
    [Email Service] as smtp
}

database "MongoDB Atlas" as db

' Presentation Layer connections
frontend --> router
frontend --> components
frontend --> context

' API connections
context --> api : HTTP/REST
router --> api : Route requests
api --> middleware
middleware --> express

' Business Logic connections
express --> controllers
controllers --> services
controllers --> helpers
services --> helpers

' Data Access connections
controllers --> mongoose
mongoose --> models
models --> db : CRUD Operations

' External Service connections
controllers --> braintree : Payment processing
controllers --> smtp : Email sending

note right of frontend
  **Technology:**
  • React 18.3
  • Bootstrap 5
  • Ant Design
  • Axios
end note

note right of express
  **Technology:**
  • Node.js
  • Express.js
  • JWT
  • Bcrypt
  • Formidable
end note

note right of db
  **Technology:**
  • MongoDB Atlas
  • Cloud database
  • Replica sets
  • Automatic backups
end note

@enduml
```

### 3. Three-Tier Architecture

```plantuml
@startuml Three_Tier_Architecture

title TechHub E-Commerce - Three-Tier Architecture

package "Tier 1: Presentation Layer\n(Client-Side)" #LightCyan {
    node "Web Browser" {
        [React Application] as react
        [Bootstrap UI] as ui
        [Local Storage] as storage
    }
}

package "Tier 2: Application Layer\n(Server-Side)" #LightYellow {
    node "Express Server" {
        [API Routes] as routes
        [Controllers] as controllers
        [Business Logic] as logic
        [Authentication] as auth
        [Jaccard Algorithm] as jaccard
    }
}

package "Tier 3: Data Layer\n(Database)" #LightGreen {
    database "MongoDB Atlas" as db {
        [Users Collection]
        [Products Collection]
        [Categories Collection]
        [Orders Collection]
    }
}

cloud "External Services" #LightPink {
    [Braintree Gateway]
    [Email SMTP]
}

' Connections
react --> storage : State persistence
react --> routes : HTTP REST API\n(Port 8080)
routes --> controllers
controllers --> logic
controllers --> auth
logic --> jaccard
controllers --> db : Mongoose ODM
controllers --> [Braintree Gateway] : Payment API
controllers --> [Email SMTP] : Send emails

note bottom of react
  **Tier 1 Responsibilities:**
  • User interface rendering
  • User input handling
  • Client-side validation
  • State management (Context API)
  • Session storage (localStorage)

  **Technology Stack:**
  • React 18.3
  • React Router 6.29
  • Axios
  • Bootstrap 5.3
  • Ant Design
end note

note bottom of controllers
  **Tier 2 Responsibilities:**
  • Business logic execution
  • API endpoint handling
  • Authentication & authorization
  • Data validation
  • Integration with external services
  • Product recommendations (Jaccard)

  **Technology Stack:**
  • Node.js (ES6 modules)
  • Express.js
  • JWT (jsonwebtoken)
  • Bcrypt
  • Express Formidable
  • Morgan logger
end note

note bottom of db
  **Tier 3 Responsibilities:**
  • Data persistence
  • Data integrity
  • Query optimization
  • Indexing
  • Backup & recovery

  **Technology Stack:**
  • MongoDB Atlas (Cloud)
  • Mongoose 7.x
  • Automatic replication
  • Point-in-time recovery
end note

@enduml
```

### 4. Data Flow Architecture

```plantuml
@startuml Data_Flow_Architecture

title TechHub E-Commerce - Data Flow Architecture

!define RECTANGLE rectangle

RECTANGLE "User Actions" as user #LightBlue
RECTANGLE "Frontend\n(React)" as frontend #LightCyan
RECTANGLE "API Gateway\n(Express)" as api #LightYellow
RECTANGLE "Business Logic\n(Controllers)" as logic #LightGreen
RECTANGLE "Database\n(MongoDB)" as db #LightPink
RECTANGLE "External\nServices" as external #LightGray

user -down-> frontend : User interactions
frontend -down-> api : HTTP requests\n(JSON payload)
api -down-> logic : Parsed requests
logic -down-> db : Queries\n(CRUD operations)
db -up-> logic : Query results
logic -down-> external : Service calls
external -up-> logic : Service responses
logic -up-> api : Processed data
api -up-> frontend : JSON responses
frontend -up-> user : UI updates

note right of frontend
  **Request Flow:**
  1. User action (click, submit)
  2. Axios HTTP request
  3. JWT token attached
  4. Data serialization (JSON)
end note

note right of api
  **Middleware Pipeline:**
  1. CORS handling
  2. JSON parsing
  3. JWT verification
  4. File upload parsing
  5. Route to controller
end note

note right of logic
  **Processing:**
  1. Input validation
  2. Business rules
  3. Data transformation
  4. Database operations
  5. Response formatting
end note

note right of db
  **Data Operations:**
  • CREATE: Insert new documents
  • READ: Query collections
  • UPDATE: Modify documents
  • DELETE: Remove documents
  • AGGREGATE: Complex queries
end note

@enduml
```

### 5. Security Architecture

```plantuml
@startuml Security_Architecture

title TechHub E-Commerce - Security Architecture

package "Client-Side Security" {
    [Input Validation] as clientValidation
    [XSS Prevention] as xss
    [HTTPS Only] as https
    [JWT Storage] as jwtStorage
}

package "Network Security" {
    [CORS Policy] as cors
    [SSL/TLS] as ssl
    [Rate Limiting] as rateLimiting
}

package "Server-Side Security" {
    [JWT Verification] as jwtVerify
    [Role-Based Access] as rbac
    [Input Sanitization] as sanitization
    [SQL Injection Prevention] as sqlPrevention
    [Password Hashing] as passwordHash
}

package "Data Security" {
    [Encryption at Rest] as encryptRest
    [Encryption in Transit] as encryptTransit
    [Access Control] as dbAccess
    [Audit Logging] as logging
}

actor User
actor Attacker

User --> clientValidation : Submit data
clientValidation --> https
https --> ssl
ssl --> cors
cors --> jwtVerify
jwtVerify --> rbac
rbac --> sanitization
sanitization --> sqlPrevention
sqlPrevention --> passwordHash
passwordHash --> encryptRest

Attacker -[#red]-> xss : <span style="color:red">XSS Attack</span>
xss -[#green]-> clientValidation : <span style="color:green">Blocked</span>

Attacker -[#red]-> rateLimiting : <span style="color:red">Brute Force</span>
rateLimiting -[#green]-> jwtVerify : <span style="color:green">Rate Limited</span>

Attacker -[#red]-> sqlPrevention : <span style="color:red">Injection Attack</span>
sqlPrevention -[#green]-> encryptRest : <span style="color:green">Prevented</span>

note right of clientValidation
  **Client-Side Defenses:**
  • React escapes JSX by default
  • Form validation before submission
  • HTTPS enforced
  • Sensitive data not in localStorage
end note

note right of jwtVerify
  **JWT Security:**
  • Signed with secret key
  • Expiration time enforced
  • Verified on each request
  • Role embedded in payload
end note

note right of passwordHash
  **Password Security:**
  • Bcrypt hashing (10 rounds)
  • Salt automatically generated
  • One-way encryption
  • Never stored in plain text
end note

note right of encryptRest
  **Database Security:**
  • MongoDB encryption at rest
  • Network encryption (TLS)
  • IP whitelisting
  • Database user authentication
end note

@enduml
```

## How to View These Diagrams

### In VS Code
1. Install "PlantUML" extension by jebbs
2. Copy each PlantUML code block
3. Create separate `.puml` files
4. Press `Alt+D` to preview

### Online
1. Go to: http://www.plantuml.com/plantuml/uml/
2. Copy code between \`\`\`plantuml tags
3. Paste and view

## System Design Explanations

### 1. System Context Diagram

**Purpose:** Shows the system boundaries and external interactions.

**Actors:**
- **Customer**: End users who browse and purchase products
- **Admin**: System administrators who manage the platform

**External Systems:**
- **Braintree Payment Gateway**: PCI-compliant payment processing
- **Email Service (SMTP)**: Notification delivery
- **MongoDB Atlas**: Cloud database service
- **Web Browser**: Client access point

**System Boundaries:**
The TechHub E-Commerce System encompasses:
- Frontend React application
- Backend Express API
- Business logic and services
- Authentication and authorization
- Product recommendation engine (Jaccard)

**External Dependencies:**
All external services are replaceable:
- Braintree → Stripe, PayPal
- SMTP → SendGrid, AWS SES
- MongoDB Atlas → Self-hosted MongoDB, PostgreSQL

### 2. High-Level System Architecture

**Purpose:** Shows major architectural components and their relationships.

**Layered Architecture:**

1. **Presentation Layer**
   - React components
   - Routing
   - State management (Context API)
   - UI rendering

2. **API Layer**
   - Express server
   - REST API endpoints
   - Middleware stack (CORS, JWT, File upload)
   - Request/response handling

3. **Business Logic Layer**
   - Controllers (route handlers)
   - Services (reusable business logic)
   - Helpers (utility functions)
   - Jaccard recommendation algorithm

4. **Data Access Layer**
   - Mongoose ODM
   - Schema definitions
   - Query builders
   - Database connections

**Separation of Concerns:**
Each layer has a specific responsibility, allowing:
- Independent testing
- Technology replacement
- Scalability
- Maintainability

### 3. Three-Tier Architecture

**Purpose:** Classic three-tier pattern for scalability and separation.

**Tier 1: Presentation (Client-Side)**
- **Location**: User's web browser
- **Technology**: React, Bootstrap, Ant Design
- **Responsibilities**: UI rendering, user input, client-side validation
- **State Management**: Context API + localStorage
- **Communication**: HTTP REST API to Tier 2

**Tier 2: Application (Server-Side)**
- **Location**: Node.js server (Port 8080)
- **Technology**: Express.js, JWT, Bcrypt
- **Responsibilities**: Business logic, authentication, data processing
- **API**: RESTful endpoints at `/api/v1/*`
- **Communication**: Mongoose ODM to Tier 3

**Tier 3: Data (Database)**
- **Location**: MongoDB Atlas (Cloud)
- **Technology**: MongoDB, Mongoose
- **Responsibilities**: Data persistence, integrity, querying
- **Collections**: users, products, categories, orders
- **Backup**: Automatic cloud backups

**Benefits:**
- ✅ Scalability: Each tier can scale independently
- ✅ Security: Database not directly accessible from client
- ✅ Maintainability: Clear separation of concerns
- ✅ Flexibility: Technology changes isolated to specific tier

### 4. Data Flow Architecture

**Purpose:** Shows how data moves through the system.

**Request Flow (Client → Server):**
```
1. User Action (e.g., "Add to Cart")
2. React component triggers Axios request
3. JWT token attached to Authorization header
4. HTTP POST request to /api/v1/product/...
5. Express receives and parses request
6. CORS middleware validates origin
7. JWT middleware verifies token
8. Controller executes business logic
9. Mongoose queries MongoDB
10. Database returns results
```

**Response Flow (Server → Client):**
```
1. Controller processes database results
2. Data formatted as JSON
3. HTTP response with status code
4. Axios receives response
5. React state updated (Context/useState)
6. Component re-renders
7. UI updates visible to user
```

**Data Transformations:**
- **Client → Server**: Form data → JSON → Buffer (images)
- **Server → Database**: JSON → BSON (MongoDB format)
- **Database → Server**: BSON → JSON
- **Server → Client**: JSON → JavaScript objects → React state

### 5. Security Architecture

**Purpose:** Multi-layered defense-in-depth security approach.

**Security Layers:**

1. **Client-Side Security**
   - Input validation (format, length, type)
   - XSS prevention (React escapes JSX)
   - HTTPS enforcement
   - Secure JWT storage (not in cookies if vulnerable)

2. **Network Security**
   - CORS policy (whitelist origins)
   - SSL/TLS encryption in transit
   - Rate limiting (prevent brute force)
   - Request size limits

3. **Server-Side Security**
   - JWT verification on protected routes
   - Role-based access control (RBAC)
   - Input sanitization and validation
   - NoSQL injection prevention (Mongoose escaping)
   - Bcrypt password hashing

4. **Data Security**
   - Encryption at rest (MongoDB Atlas)
   - Encryption in transit (TLS)
   - Database access control (IP whitelist)
   - Audit logging (request logs)

**Attack Prevention:**

| Attack Type | Prevention Method |
|-------------|-------------------|
| XSS | React JSX escaping, Content Security Policy |
| CSRF | JWT tokens (not cookies), SameSite cookies |
| SQL Injection | Mongoose parameterized queries |
| Brute Force | Rate limiting, account lockout |
| Man-in-Middle | HTTPS/TLS encryption |
| Session Hijacking | JWT expiration, secure storage |
| Unauthorized Access | JWT verification + role checks |

## System Scalability

### Horizontal Scaling

**Frontend:**
- Static files served via CDN
- Multiple instances behind load balancer
- Stateless design (JWT tokens)

**Backend:**
- Multiple Express server instances
- Load balancer distribution
- Stateless API (no session storage)

**Database:**
- MongoDB replica sets
- Read replicas for scaling reads
- Sharding for scaling writes

### Vertical Scaling

- Increase server CPU/RAM
- Optimize database queries
- Add indexes to collections
- Cache frequently accessed data

### Caching Strategy

**Client-Side:**
- localStorage for cart and auth
- Browser cache for static assets
- Service workers (optional PWA)

**Server-Side:**
- Redis for session data (if needed)
- In-memory caching for categories
- Query result caching

**Database:**
- MongoDB built-in caching
- Index optimization
- Aggregation pipeline

## System Monitoring

### Application Monitoring
- Request/response logging (Morgan)
- Error tracking and alerting
- Performance metrics (response times)
- API endpoint usage statistics

### Infrastructure Monitoring
- Server CPU, memory, disk usage
- Network latency
- Database query performance
- External service availability (Braintree, SMTP)

### Business Metrics
- Order completion rate
- Payment success rate
- Search result relevance
- Recommendation click-through rate
- Cart abandonment rate

## Disaster Recovery

### Backup Strategy
- **Database**: Automatic daily backups (MongoDB Atlas)
- **Code**: Git version control
- **Configuration**: Environment variable documentation
- **Media**: Product images in database (Buffer)

### Recovery Time Objective (RTO)
- Database restore: < 1 hour (MongoDB Atlas)
- Application deployment: < 30 minutes
- Total system recovery: < 2 hours

### Recovery Point Objective (RPO)
- Maximum data loss: 24 hours (daily backups)
- Transaction logs: Real-time replication

## Technology Stack Summary

| Layer | Technology | Purpose |
|-------|-----------|---------|
| **Frontend** | React 18.3 | UI framework |
| | React Router 6.29 | Client-side routing |
| | Axios | HTTP client |
| | Bootstrap 5.3 | CSS framework |
| | Ant Design | UI components |
| **Backend** | Node.js | Runtime environment |
| | Express.js | Web framework |
| | JWT | Authentication |
| | Bcrypt | Password hashing |
| | Formidable | File uploads |
| | Morgan | Request logging |
| **Database** | MongoDB Atlas | NoSQL database |
| | Mongoose 7.x | ODM |
| **External** | Braintree | Payment gateway |
| | SMTP | Email service |
| **DevOps** | Nodemon | Development auto-reload |
| | Concurrently | Run multiple processes |
| | Git | Version control |

## Related Diagrams

- [COMPONENT_DIAGRAM.md](COMPONENT_DIAGRAM.md) - Detailed component relationships
- [DEPLOYMENT_DIAGRAM.md](DEPLOYMENT_DIAGRAM.md) - Infrastructure and deployment
- [ARCHITECTURE_DIAGRAM.puml](ARCHITECTURE_DIAGRAM.puml) - System architecture variations

---

**Last Updated:** 2025-11-23
**Diagram Type:** System Design / Architecture Diagrams
**Purpose:** High-Level System Design and Architecture Documentation
